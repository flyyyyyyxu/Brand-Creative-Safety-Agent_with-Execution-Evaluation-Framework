# Brand Creative Safety Agentï¼ˆAllbirdsï¼‰- å¢å¼ºç‰ˆå¼€å‘æŒ‡å—

> **é‡è¦åŸåˆ™**ï¼šæœ¬ README ä»¥"é›¶ä»£ç åŸºç¡€ä¹Ÿèƒ½ä¸€æ­¥ä¸€æ­¥æ¨è¿›"ä¸ºåŸåˆ™ã€‚æ¯ä¸€æ­¥çš„è¾“å‡ºï¼ˆæ—¥å¿—/æŠ¥é”™/æ–‡ä»¶å†…å®¹ï¼‰éƒ½å¯ä»¥ç²˜è´´ç»™ ChatGPT/Claudeï¼Œè®© AI å¸®ä½ ç»§ç»­æ¨è¿›ã€‚

---

## ç›®å½•
- [0. é¡¹ç›®å®šä¹‰](#0-é¡¹ç›®å®šä¹‰)
- [1. è¾“å…¥è¾“å‡ºç¤ºä¾‹](#1-è¾“å…¥è¾“å‡ºç¤ºä¾‹)
- [2. æŠ€æœ¯æ–¹æ¡ˆä¸é£é™©ç¼“è§£](#2-æŠ€æœ¯æ–¹æ¡ˆä¸é£é™©ç¼“è§£)
- [3. ç¯å¢ƒä¸éƒ¨ç½²](#3-ç¯å¢ƒä¸éƒ¨ç½²)
- [4. åˆ†é˜¶æ®µéªŒè¯æ­¥éª¤ï¼ˆæœ€é‡è¦ï¼‰](#4-åˆ†é˜¶æ®µéªŒè¯æ­¥éª¤æœ€é‡è¦)
- [5. é£é™©è¯„åˆ†å…¬å¼](#5-é£é™©è¯„åˆ†å…¬å¼)
- [6. æ•…éšœæ’æŸ¥](#6-æ•…éšœæ’æŸ¥)

---

## 0. é¡¹ç›®å®šä¹‰

### 0.1 é¡¹ç›®ç›®æ ‡ï¼ˆä¸€å¥è¯ï¼‰

ä¸ºå“ç‰Œï¼ˆé»˜è®¤ Allbirdsï¼‰æ„å»ºä¸€ä¸ª"èˆ†æƒ…/åˆ›æ„å®‰å…¨ç›‘æ§ Agent"ï¼Œè‡ªåŠ¨æ”¶é›†å¤šæ¥æºé£é™©ä¿¡å·ï¼Œå¹¶è¾“å‡ºå¯è¯„ä¼°ã€å¯å¯¹æ¯”ã€å¯å¤ç›˜çš„æ•°æ®ã€‚

### 0.2 æœ€ç»ˆäº¤ä»˜ç‰©

1. **ä¸€ä¸ªå¯è¿è¡Œçš„ Agent**ï¼šç»™å®šä»»åŠ¡é›†ï¼ˆqueriesï¼‰è‡ªåŠ¨æœç´¢ â†’ æ‰“å¼€ç½‘é¡µ â†’ æå–ä¿¡æ¯ â†’ æƒ…ç»ª/é£é™©åˆ†æ â†’ è¾“å‡ºç»“æ„åŒ–ç»“æœ
2. **ä¸€å¥—è¯„ä¼°æ¡†æ¶ï¼ˆEval Harnessï¼‰**ï¼šèƒ½ç»Ÿè®¡æˆåŠŸç‡ã€å¤±è´¥ç±»å‹ã€å¹³å‡æ­¥æ•°ã€å»¶è¿Ÿã€æˆæœ¬ç­‰
3. **ä¸‰ç»„ç­–ç•¥å®éªŒ A/B/C çš„å¯¹æ¯”ç»“æœ**ï¼ˆå¯å†™è¿›ç®€å†ã€å¯é¢è¯•è®²è¿°ï¼‰

### 0.3 ä¸ºä»€ä¹ˆè¿™ä¸ªé€‰é¢˜é€‚åˆæŠ• Axon

- Axon/å¹¿å‘Šç³»ç»Ÿéå¸¸é‡è§†**å“ç‰Œå®‰å…¨**ï¼ˆå¹¿å‘Šå±•ç¤ºç¯å¢ƒ/åˆ›æ„é£é™©/èˆ†è®ºåå™¬ï¼‰
- ä½ åœ¨æ­¤é¡¹ç›®ä¸­å±•ç¤ºçš„èƒ½åŠ›æ˜¯ï¼š
  - æŠŠ"èˆ†è®º/é£é™©"æŠ½è±¡æˆå¯é‡åŒ–çš„ä¿¡å·ä¸æŒ‡æ ‡
  - è®© Agent åœ¨çœŸå®ç½‘é¡µç¯å¢ƒä¸‹ç¨³å®šæ‰§è¡Œï¼ˆè¿™å¾ˆåƒå¹³å°/infra çš„å¯é æ€§å·¥ä½œï¼‰
  - ç”¨ A/B å®éªŒæ–¹æ³•éªŒè¯ç­–ç•¥ï¼ˆæ›´åƒ PM çš„å·¥ä½œæ–¹å¼ï¼‰

---

## 1. è¾“å…¥è¾“å‡ºç¤ºä¾‹

### 1.1 è¾“å…¥æ˜¯ä»€ä¹ˆ

è¾“å…¥ç”± `datasets/tasks.json` å®šä¹‰ï¼š
- **brand**ï¼šAllbirds
- **tasks**ï¼š12 æ¡å›ºå®šä»»åŠ¡ï¼ˆä¾‹å¦‚ "Allbirds scam / complaint / greenwashing â€¦"ï¼‰
- **strategies**ï¼šA/B/C ä¸‰ç§ç­–ç•¥
- **run_defaults**ï¼šè¶…æ—¶ã€æœ€å¤§æ­¥æ•°ã€å¤±è´¥æ—¶æˆªå›¾ç­‰

ä½ ä¹Ÿä¼šæœ‰ä¸€ä¸ªåŸŸåç™½åå• `datasets/allowlist.txt`ï¼ˆç”¨äºç­–ç•¥ B/Cï¼‰ã€‚

### 1.2 è¾“å‡ºæ˜¯ä»€ä¹ˆ

æ¯æ¬¡è¿è¡Œä¼šç”Ÿæˆä¸€æ¡"run record"ï¼Œå¹¶è¿½åŠ å†™å…¥ `artifacts/runs.jsonl`ï¼ˆæ¯è¡Œä¸€ä¸ª JSONï¼‰ã€‚

è¾“å‡ºå­—æ®µç”± `eval/schema.json` çº¦æŸï¼ˆè¿™ä¸€æ­¥éå¸¸å…³é”®ï¼Œå®ƒä¿è¯ä½ åé¢èƒ½åšç»Ÿè®¡ä¸å¯¹æ¯”ï¼‰ã€‚

**è¾“å‡ºç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰**ï¼š

```json
{
  "run_id": "...",
  "timestamp_utc": "2026-02-14T18:00:00Z",
  "brand": "Allbirds",
  "task_id": "T2",
  "strategy_id": "B",
  "query": "Allbirds complaint",
  "success": true,
  "failure_type": null,
  "step_count": 6,
  "latency_ms": 12850,
  "token_cost_estimate": 520,
  "sources": [
    {
      "source_type": "forum",
      "title": "Allbirds quality issues?",
      "url": "https://...",
      "snippet": "..."
    }
  ],
  "analysis": {
    "summary": "ç”¨æˆ·é›†ä¸­æŠ±æ€¨å°ºç ã€è€ä¹…åº¦...",
    "sentiment": {"label": "negative", "score": -0.6},
    "risk_keywords": ["quality", "refund", "misleading"],
    "relevance_score": 0.92
  },
  "risk": {
    "negative_ratio": 0.67,
    "keyword_weight": 0.55,
    "recentness_factor": 0.73,
    "risk_score": 0.64,
    "risk_level": "high"
  },
  "debug": {"notes": "...", "screenshot_path": null, "trace_path": null}
}
```

---

## 2. æŠ€æœ¯æ–¹æ¡ˆä¸é£é™©ç¼“è§£

### 2.1 ä¸‰å±‚æ¶æ„

1. **Execution Layerï¼ˆæ‰§è¡Œå±‚ï¼‰**ï¼šOpenClaw é©±åŠ¨æµè§ˆå™¨/å·¥å…·æ‰§è¡Œ
2. **Evaluation Layerï¼ˆè¯„ä¼°å±‚ï¼‰**ï¼šç»Ÿä¸€ schema + æŒ‡æ ‡ç»Ÿè®¡
3. **Product Layerï¼ˆäº§å“å±‚ï¼‰**ï¼šé£é™©è¯„åˆ†ä¸ç­–ç•¥ä¼˜åŒ–

### 2.2 å…³é”®é£é™©ç‚¹ä¸ç¼“è§£æ–¹æ¡ˆ

#### âš ï¸ **é£é™©ç‚¹ 1ï¼šOpenClaw ç¨³å®šæ€§é—®é¢˜ï¼ˆæœ€å¤§é£é™©ï¼‰**

**é—®é¢˜æè¿°**ï¼š
Web Agent åœ¨çœŸå®ç¯å¢ƒä¸­å¤±è´¥ç‡é€šå¸¸å¾ˆé«˜ï¼ˆ30-50%ï¼‰ã€‚OpenClaw å¯èƒ½å› ä¸ºä»¥ä¸‹åŸå› å¤±è´¥ï¼š
- é¡µé¢åŠ è½½è¶…æ—¶
- æœç´¢ç»“æœæ ¼å¼å˜åŒ–
- å¹¿å‘Š/å¼¹çª—å¹²æ‰°
- ç½‘é¡µç»“æ„ä¸ç¬¦åˆé¢„æœŸ

**ç¼“è§£æ–¹æ¡ˆï¼ˆ3 ä¸ªå±‚æ¬¡ï¼‰**ï¼š

##### **å±‚æ¬¡ 1ï¼šé™ä½æœŸæœ›å€¼ï¼ˆæ¥å—å¤±è´¥æ˜¯æ­£å¸¸çš„ï¼‰**
```
æˆåŠŸç‡ç›®æ ‡ï¼š
- é˜¶æ®µ 1ï¼ˆæœ€å°éªŒè¯ï¼‰ï¼š>30%
- é˜¶æ®µ 2ï¼ˆç¨³å®šæ€§ä¼˜åŒ–ï¼‰ï¼š>60%
- é˜¶æ®µ 3ï¼ˆç”Ÿäº§å°±ç»ªï¼‰ï¼š>80%
```

æŠŠ"Agent æœ¬èº«çš„å¤±è´¥"ä¹Ÿä½œä¸ºå®éªŒæ•°æ®è®°å½•ï¼š
```json
"failure_type": "agent_timeout",  // Agent è¶…æ—¶
"failure_type": "parse_error",     // æ— æ³•è§£æé¡µé¢ç»“æ„
"failure_type": "no_results",      // æœç´¢æ— ç»“æœ
"failure_type": "blocked_by_captcha" // è¢«éªŒè¯ç æ‹¦æˆª
```

##### **å±‚æ¬¡ 2ï¼šè®¾ç½®ä¸¥æ ¼çš„è¶…æ—¶ä¸é‡è¯•æœºåˆ¶**

åœ¨ `datasets/tasks.json` ä¸­è®¾ç½®ï¼š
```json
"run_defaults": {
  "timeout_seconds": 90,        // å•æ¬¡ run æ€»è¶…æ—¶
  "max_steps": 8,               // æœ€å¤§æ­¥æ•°ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
  "step_timeout_seconds": 15,   // å•æ­¥è¶…æ—¶
  "retry_on_failure": false,    // é˜¶æ®µ 1 ä¸é‡è¯•ï¼Œä¿æŒæ•°æ®çœŸå®æ€§
  "screenshot_on_failure": true // å¤±è´¥æ—¶æˆªå›¾ï¼Œä¾¿äºè°ƒè¯•
}
```

**å»ºè®®æˆæœ¬é¢„ç®—ï¼ˆMiniMax 100 prompts/5hï¼‰**ï¼š
```
é¢„ä¼°å•æ¬¡ run æ¶ˆè€—ï¼š2-4 prompts
12 tasks Ã— 3 strategies Ã— 3 repeats = 108 runs
æ€»æ¶ˆè€—ï¼š216-432 promptsï¼ˆåˆ†æ‰¹è·‘ï¼Œæ¯æ‰¹ 30-50 runsï¼‰

ä¿é™©ç­–ç•¥ï¼š
- å…ˆè·‘ 1 ä¸ª task Ã— 3 strategies = 9 runsï¼ŒéªŒè¯æˆæœ¬
- å¦‚æœå•æ¬¡è¶…è¿‡ 5 promptsï¼Œéœ€è¦é™ä½ max_steps
```

##### **å±‚æ¬¡ 3ï¼šPlan B - é™çº§ä¸ºåŠè‡ªåŠ¨æ–¹æ¡ˆ**

å¦‚æœ OpenClaw æˆåŠŸç‡ <30%ï¼Œå¯åŠ¨å¤‡é€‰æ–¹æ¡ˆï¼š

**å¤‡é€‰æ–¹æ¡ˆ Aï¼šæ‰‹åŠ¨çˆ¬è™« + Claude åˆ†æ**
```python
# ç”¨ Playwright æ‰‹åŠ¨æŠ“å–æ•°æ®
import asyncio
from playwright.async_api import async_playwright

async def fallback_scrape(query):
    async with async_playwright() as p:
        browser = await p.chromium.launch()
        page = await browser.new_page()
        await page.goto(f"https://www.google.com/search?q={query}")
        # æå–å‰ 3 ä¸ªç»“æœ
        results = await page.query_selector_all(".g")
        # æ‰‹åŠ¨è§£æ...
```

ç„¶åç”¨ Claude API åšæƒ…ç»ªåˆ†æå’Œé£é™©è¯„åˆ†ï¼ˆè¿™éƒ¨åˆ†ä¸€å®šèƒ½è·‘é€šï¼‰ã€‚

**å¤‡é€‰æ–¹æ¡ˆ Bï¼šèšç„¦å•ä¸€æ•°æ®æº**
```
åªçˆ¬ Reddit çš„ r/Allbirds æˆ–å…¬å¼€è®ºå›
ç”¨ PRAW (Python Reddit API Wrapper) ç›´æ¥è·å–æ•°æ®
é¿å¼€ Web Agent çš„å¤æ‚æ€§
```

**å¦‚ä½•åˆ¤æ–­æ˜¯å¦éœ€è¦é™çº§**ï¼š
```bash
# é˜¶æ®µ 1 ç»“æŸåè¿è¡Œè¯„ä¼°è„šæœ¬ï¼ˆåç»­ä¼šåˆ›å»ºï¼‰
python eval/analyze.py artifacts/runs.jsonl

# å¦‚æœè¾“å‡ºæ˜¾ç¤ºï¼š
# Success rate: 12% (ç­–ç•¥ A)
# Failure types: agent_timeout (60%), parse_error (28%)

# â†’ å¯åŠ¨å¤‡é€‰æ–¹æ¡ˆ
```

---

#### âš ï¸ **é£é™©ç‚¹ 2ï¼šåçˆ¬ä¸ç½‘é¡µå˜åŒ–**

**é—®é¢˜æè¿°**ï¼š
å³ä½¿æ˜¯å…¬å¼€ç½‘é¡µï¼Œä¹Ÿå¯èƒ½é‡åˆ°ï¼š
- Cloudflare éªŒè¯
- åŠ¨æ€åŠ è½½ï¼ˆéœ€è¦ç­‰å¾… JS æ‰§è¡Œï¼‰
- é¡µé¢ç»“æ„é¢‘ç¹å˜åŒ–
- ç™»å½•å¢™ï¼ˆReddit/Twitterï¼‰

**ç¼“è§£æ–¹æ¡ˆ**ï¼š

##### **ä¼˜å…ˆé€‰æ‹©ç»“æ„ç¨³å®šçš„ç«™ç‚¹**

ç¼–è¾‘ `datasets/allowlist.txt`ï¼Œä¼˜å…ˆåŒ…å«ï¼š
```
# æ–°é—»åª’ä½“ï¼ˆç»“æ„ç¨³å®šï¼Œæ— ç™»å½•å¢™ï¼‰
nytimes.com
theguardian.com
forbes.com
businessinsider.com

# æ¶ˆè´¹è€…è¯„æµ‹ï¼ˆå…¬å¼€è®¿é—®ï¼‰
trustpilot.com
consumeraffairs.com
bbb.org

# å¯æŒç»­æ€§ç›¸å…³ï¼ˆAllbirds ä¸»æ‰“ç¯ä¿ï¼‰
greenbiz.com
sustainablebrands.com

# è®ºå›ï¼ˆéœ€è¦æ§åˆ¶è®¿é—®é¢‘ç‡ï¼‰
reddit.com/r/Allbirds  # ä»…æ­¤å­ç‰ˆå—
quora.com

# é¿å…çš„ç«™ç‚¹ï¼ˆé«˜é£é™©ï¼‰
# instagram.com    - éœ€è¦ç™»å½•
# tiktok.com       - éœ€è¦ç™»å½•
# twitter.com/x.com - éœ€è¦ç™»å½•
# facebook.com     - éœ€è¦ç™»å½•
```

##### **Reddit ä¸“ç”¨é…ç½®ï¼ˆä½ å·²æœ‰ç»éªŒï¼‰**

åœ¨ Agent ä»£ç ä¸­å¢åŠ  Reddit ç‰¹æ®Šå¤„ç†ï¼š
```python
# agent/agent.py ä¸­çš„é…ç½®
RATE_LIMIT_CONFIG = {
    "reddit.com": {
        "min_interval_seconds": 5,  # æœ€å°é—´éš” 5 ç§’
        "max_requests_per_minute": 10
    },
    "default": {
        "min_interval_seconds": 2
    }
}
```

##### **å¢åŠ  failure_type åˆ†ç±»**

åœ¨ schema ä¸­è¡¥å……ï¼š
```json
"failure_type": {
  "enum": [
    null,
    "not_implemented",
    "agent_timeout",
    "parse_error",
    "no_results",
    "blocked_by_captcha",     // è¢«éªŒè¯ç æ‹¦æˆª
    "page_load_timeout",      // é¡µé¢åŠ è½½è¶…æ—¶
    "login_required",         // éœ€è¦ç™»å½•
    "irrelevant_content"      // å†…å®¹ä¸ç›¸å…³ï¼ˆç­–ç•¥ C ä¼šç”¨ï¼‰
  ]
}
```

---

#### âš ï¸ **é£é™©ç‚¹ 3ï¼šæˆæœ¬æ§åˆ¶**

**é—®é¢˜æè¿°**ï¼š
MiniMax 100 prompts/5h çš„é™åˆ¶ï¼Œéœ€è¦ç²¾ç¡®æ§åˆ¶æ¯æ¬¡ run çš„æ¶ˆè€—ã€‚

**ç¼“è§£æ–¹æ¡ˆ**ï¼š

##### **å•æ¬¡ run æˆæœ¬ä¼°ç®—**
```
å‡è®¾ OpenClaw æ¯æ­¥æ¶ˆè€— 1 promptï¼š
- æœç´¢ï¼š1 prompt
- æ‰“å¼€é¡µé¢ï¼š1 prompt
- æå–ä¿¡æ¯ï¼š1 prompt
- æƒ…ç»ªåˆ†æï¼š1 prompt
æ€»è®¡ï¼š4 prompts/runï¼ˆç†æƒ³æƒ…å†µï¼‰

å®é™…å¯èƒ½ï¼š
- æœ‰é‡è¯•ï¼š6-8 prompts/run
- é¡µé¢å¤æ‚ï¼š10+ prompts/run
```

##### **åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é™åˆ¶**

```python
# agent/agent.py
MAX_PROMPTS_PER_RUN = 10  # ç¡¬ä¸Šé™ï¼Œé˜²æ­¢å•æ¬¡ run å¤±æ§
prompt_counter = 0

def call_openclaw_step():
    global prompt_counter
    if prompt_counter >= MAX_PROMPTS_PER_RUN:
        raise Exception("Exceeded max prompts per run")
    prompt_counter += 1
    # ... OpenClaw è°ƒç”¨ ...
```

##### **åˆ†æ‰¹æ‰§è¡Œç­–ç•¥**

```bash
# ä¸è¦ä¸€æ¬¡è·‘å®Œ 108 runs

# æ‰¹æ¬¡ 1ï¼šå•ä»»åŠ¡å¤šç­–ç•¥ï¼ˆéªŒè¯æˆæœ¬ï¼‰
python agent/batch_runner.py --task_ids T1 --all_strategies --repeat 3
# é¢„ä¼°ï¼š9 runs Ã— 6 prompts = 54 prompts

# æ‰¹æ¬¡ 2ï¼šå¦‚æœæˆæœ¬å¯æ§ï¼Œæ‰©å¤§åˆ° 3 ä¸ªä»»åŠ¡
python agent/batch_runner.py --task_ids T1,T2,T3 --all_strategies --repeat 3
# é¢„ä¼°ï¼š27 runs Ã— 6 prompts = 162 prompts

# æ‰¹æ¬¡ 3ï¼šå…¨é‡ï¼ˆå¦‚æœå‰é¢éƒ½é¡ºåˆ©ï¼‰
python agent/batch_runner.py --all_tasks --all_strategies --repeat 3
```

##### **ç›‘æ§å®æ—¶æ¶ˆè€—**

åœ¨æ¯æ¬¡ run åè¾“å‡ºï¼š
```bash
# åœ¨ batch_runner.py ä¸­åŠ å…¥
print(f"Completed {run_count}/{total_runs} | Estimated prompts used: {prompt_counter}")
print(f"Remaining quota: ~{100 - prompt_counter} prompts")
```

---

#### âš ï¸ **é£é™©ç‚¹ 4ï¼š"é›¶ä»£ç åŸºç¡€"çš„ç°å®æ€§**

**é—®é¢˜æè¿°**ï¼š
README è¯´"é›¶ä»£ç åŸºç¡€ä¹Ÿèƒ½æ¨è¿›"ï¼Œä½†å®é™…ä¸Šéœ€è¦ï¼š
- ç†è§£ Python ç¯å¢ƒé…ç½®
- è°ƒè¯• OpenClaw çš„å®‰è£…å’Œæµè§ˆå™¨ä¾èµ–
- å¤„ç† JSON Schema éªŒè¯é”™è¯¯

**ç¼“è§£æ–¹æ¡ˆ**ï¼š

##### **æä¾›å®Œæ•´çš„ä¾èµ–å®‰è£…è„šæœ¬**

åˆ›å»º `scripts/setup.sh`ï¼ˆè§ä¸‹æ–‡"è‡ªåŠ¨åŒ–è„šæœ¬"éƒ¨åˆ†ï¼‰

##### **å¯¹æ¯ä¸ªé”™è¯¯ç±»å‹æä¾› troubleshooting æ–‡æ¡£**

è§ä¸‹æ–‡"æ•…éšœæ’æŸ¥"éƒ¨åˆ†

##### **ä½¿ç”¨"é”™è¯¯ â†’ AI è¾…åŠ©"å·¥ä½œæµ**

```
ä½ çš„å·¥ä½œæµï¼š
1. æ‰§è¡Œå‘½ä»¤ï¼ˆå¦‚ python agent/agent.py ...ï¼‰
2. é‡åˆ°æŠ¥é”™
3. å¤åˆ¶æ•´æ®µæŠ¥é”™ä¿¡æ¯
4. ç²˜è´´ç»™ ChatGPT/Claudeï¼Œè¯´ï¼š"å¸®æˆ‘ä¿®å¤è¿™ä¸ªé”™è¯¯"
5. æ‰§è¡Œ AI ç»™å‡ºçš„ä¿®å¤å‘½ä»¤
6. ç»§ç»­

å…³é”®ï¼šä¸è¦è‡ªå·±çŒœï¼Œç›´æ¥é—® AI
```

---

### 2.3 ç­–ç•¥ A/B/C çš„çœŸå®æ„ä¹‰ï¼ˆä½ ä¼šåšçš„å®éªŒï¼‰

- **Aï¼šfree_planning**
  - è¦†ç›–å¹¿ï¼Œä½†è¯¯ç‚¹å¤šã€å¹¿å‘Šè·³è½¬å¤šã€ç¨³å®šæ€§å·®
  
- **Bï¼šallowlist_only**
  - é™åˆ¶åªè®¿é—® `allowlist.txt` é‡Œçš„åŸŸå
  - é¢„æœŸï¼šè¯¯ç‚¹/å¹¿å‘Šè·³è½¬æ˜¾è‘—ä¸‹é™ï¼ŒæˆåŠŸç‡ä¸Šå‡ï¼Œæˆæœ¬ä¸‹é™
  
- **Cï¼šallowlist + è¯­ä¹‰æ ¡éªŒ**
  - åœ¨ B çš„åŸºç¡€ä¸Šè¦æ±‚é¡µé¢ title å¿…é¡»åŒ…å« "Allbirds"
  - é¢„æœŸï¼šrelevance æ›´é«˜ï¼Œä½†å¯èƒ½å› ä¸ºè¿‡æ»¤å¤ªä¸¥å¯¼è‡´ no_result å¢åŠ ï¼ˆè¿™æ˜¯å…¸å‹ tradeoffï¼‰

è¿™ä¸‰ç§ç­–ç•¥çš„å¯¹æ¯”ï¼Œå°±æ˜¯ä½ é¢è¯•é‡Œæœ€èƒ½è®²æ¸…æ¥šçš„"äº§å“åŒ–å®éªŒ"ã€‚

---

## 3. ç¯å¢ƒä¸éƒ¨ç½²

### 3.1 å½“å‰äº‘æœåŠ¡å™¨é…ç½®

- **å¹³å°**ï¼šé˜¿é‡Œäº‘ ECS
- **ç³»ç»Ÿ**ï¼šUbuntu 22.04
- **é…ç½®**ï¼š4 vCPU / 8GiB / 40GiB

### 3.2 æ¨èå·¥ä½œæµï¼ˆé¿å…æ··ä¹±ï¼‰

- **æœ¬åœ°**ï¼šç”¨ Codex/AI è¾…åŠ©å†™ä»£ç  â†’ git commit/push
- **äº‘ç«¯**ï¼šåªåš git pull + è¿è¡Œ + ä¿å­˜ artifacts
- **.env**ï¼ˆæ¨¡å‹ key ç­‰ï¼‰åªæ”¾äº‘ç«¯ï¼Œä¸æäº¤ GitHub

### 3.3 ä¾èµ–ï¼ˆæœ€ä½è¦æ±‚ï¼‰

- Python 3.10+
- Node 20+
- OpenClawï¼ˆåç»­æ¥å…¥ï¼‰
- æµè§ˆå™¨è‡ªåŠ¨åŒ–ä¾èµ–ï¼ˆPlaywright + Chromium æˆ–ç³»ç»Ÿ Chromiumï¼‰

---

## 4. åˆ†é˜¶æ®µéªŒè¯æ­¥éª¤ï¼ˆæœ€é‡è¦ï¼‰

### ğŸ“ **é˜¶æ®µ 0ï¼šç¯å¢ƒéªŒè¯ï¼ˆé¢„è®¡ 30 åˆ†é’Ÿï¼‰**

**ç›®æ ‡**ï¼šç¡®è®¤æœåŠ¡å™¨ç¯å¢ƒå¯ç”¨ï¼Œä¾èµ–å®‰è£…æ­£ç¡®ã€‚

#### æ­¥éª¤ 0.1ï¼šæ£€æŸ¥åŸºç¡€ç¯å¢ƒ

```bash
# åœ¨äº‘ç«¯æœåŠ¡å™¨æ‰§è¡Œ
python3 --version  # åº”è¯¥ >= 3.10
node --version     # åº”è¯¥ >= 20
git --version

# ç¡®è®¤ä»“åº“å·² clone
cd ~/brand-safety-agent  # æˆ–ä½ çš„ä»“åº“è·¯å¾„
git status
```

#### æ­¥éª¤ 0.2ï¼šè¿è¡Œè‡ªåŠ¨å®‰è£…è„šæœ¬

```bash
# åˆ›å»ºå¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼ˆè§ä¸‹æ–‡"è‡ªåŠ¨åŒ–è„šæœ¬"éƒ¨åˆ†ï¼‰
bash scripts/setup.sh
```

**é¢„æœŸè¾“å‡º**ï¼š
```
âœ“ Python dependencies installed
âœ“ Node.js dependencies installed
âœ“ Playwright browsers installed
âœ“ Environment ready
```

**å¦‚æœå¤±è´¥**ï¼š
- å¤åˆ¶æ•´æ®µæŠ¥é”™ä¿¡æ¯
- ç²˜è´´ç»™ ChatGPT/Claudeï¼Œè¯´ï¼š"å¸®æˆ‘ä¿®å¤è¿™ä¸ªé”™è¯¯"
- æ‰§è¡Œ AI ç»™å‡ºçš„ä¿®å¤å‘½ä»¤

#### æ­¥éª¤ 0.3ï¼šéªŒè¯ä»»åŠ¡é›†ä¸ schema

```bash
# ç¡®è®¤è¿™äº›æ–‡ä»¶å­˜åœ¨
ls -la datasets/tasks.json
ls -la datasets/allowlist.txt
ls -la eval/schema.json

# æŸ¥çœ‹å†…å®¹
cat datasets/tasks.json | head -20
cat eval/schema.json | head -30
```

**é¢„æœŸ**ï¼šèƒ½çœ‹åˆ° JSON å†…å®¹ï¼Œæ²¡æœ‰æŠ¥é”™ã€‚

---

### ğŸ“ **é˜¶æ®µ 1ï¼šæœ€å°å¯è¡ŒéªŒè¯ï¼ˆé¢„è®¡ 2-4 å°æ—¶ï¼‰**

**ç›®æ ‡**ï¼šè¯æ˜ OpenClaw èƒ½å®Œæˆ 1 æ¬¡å®Œæ•´æµç¨‹ï¼ˆæœç´¢ â†’ æ‰“å¼€ â†’ æå–ï¼‰ã€‚

#### æ ¸å¿ƒæˆåŠŸæ ‡å‡†

```
âœ“ èƒ½å¯åŠ¨ OpenClaw
âœ“ èƒ½å®Œæˆæœç´¢ï¼ˆGoogle/Bingï¼‰
âœ“ èƒ½æ‰“å¼€ 1 ä¸ªæœç´¢ç»“æœ
âœ“ èƒ½æå– title + URL + snippet
âœ“ èƒ½å†™å…¥ artifacts/runs.jsonl
âœ“ success=true

å…è®¸å¤±è´¥çš„éƒ¨åˆ†ï¼š
- æƒ…ç»ªåˆ†æå¯ä»¥å…ˆç”¨å‡æ•°æ®
- é£é™©è¯„åˆ†å¯ä»¥å…ˆç”¨å‡æ•°æ®
- ä¸éœ€è¦åš allowlist è¿‡æ»¤
```

#### æ­¥éª¤ 1.1ï¼šè·‘é€š v0ï¼ˆåªéªŒè¯æ—¥å¿—ç®¡é“ï¼‰

```bash
# åœ¨äº‘ç«¯ä»“åº“æ ¹ç›®å½•æ‰§è¡Œ
python3 agent/agent.py --task_id T1 --strategy_id A --timeout 90 --max_steps 8
```

**é¢„æœŸè¾“å‡º**ï¼š
```
[INFO] Starting run: task=T1, strategy=A
[INFO] Writing to artifacts/runs.jsonl
[INFO] Run completed: success=false, failure_type=not_implemented
```

**éªŒè¯ç»“æœ**ï¼š
```bash
# æ£€æŸ¥è¾“å‡ºæ–‡ä»¶
ls -la artifacts/
tail -n 1 artifacts/runs.jsonl | python3 -m json.tool
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```json
{
  "run_id": "...",
  "success": false,
  "failure_type": "not_implemented",
  ...
}
```

**å¦‚æœå¤±è´¥**ï¼šè§"æ•…éšœæ’æŸ¥"éƒ¨åˆ†ã€‚

#### æ­¥éª¤ 1.2ï¼šæ¥å…¥ OpenClaw æœ€å°å®ç°

**ç›®æ ‡**ï¼šæŠŠ `agent/agent.py` ä¸­çš„ TODO æ›¿æ¢ä¸º OpenClaw è°ƒç”¨ã€‚

**æœ€å°å®ç°ä¼ªä»£ç **ï¼š
```python
# agent/agent.py (v1 æœ€å°ç‰ˆæœ¬)

def run_agent_v1(query, strategy):
    # 1. åˆå§‹åŒ– OpenClaw
    agent = OpenClaw(...)
    
    # 2. æœç´¢
    search_results = agent.search(query)
    
    # 3. æ‰“å¼€ç¬¬ 1 ä¸ªç»“æœ
    page_content = agent.open_url(search_results[0]['url'])
    
    # 4. æå–ä¿¡æ¯
    source = {
        "source_type": "unknown",  # å…ˆä¸åˆ†ç±»
        "title": page_content.title,
        "url": search_results[0]['url'],
        "snippet": page_content.snippet[:200]
    }
    
    # 5. å‡æ•°æ®å¡«å……åˆ†æéƒ¨åˆ†
    analysis = {
        "summary": "TODO",
        "sentiment": {"label": "neutral", "score": 0.0},
        "risk_keywords": [],
        "relevance_score": 0.5
    }
    
    # 6. è¿”å›ç»“æœ
    return {
        "success": True,
        "failure_type": None,
        "sources": [source],
        "analysis": analysis,
        ...
    }
```

**éªŒè¯å‘½ä»¤**ï¼š
```bash
python3 agent/agent.py --task_id T1 --strategy_id A --timeout 90 --max_steps 8
```

**é¢„æœŸè¾“å‡º**ï¼š
```
[INFO] Starting run: task=T1, strategy=A
[INFO] OpenClaw initialized
[INFO] Searching for: Allbirds scam
[INFO] Found 10 results
[INFO] Opening: https://...
[INFO] Extracted: title="...", url="..."
[INFO] Writing to artifacts/runs.jsonl
[INFO] Run completed: success=true
```

**éªŒè¯ç»“æœ**ï¼š
```bash
tail -n 1 artifacts/runs.jsonl | python3 -m json.tool
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```json
{
  "success": true,
  "sources": [
    {
      "title": "...",
      "url": "https://...",
      "snippet": "..."
    }
  ]
}
```

#### é˜¶æ®µ 1 æˆåŠŸæ ‡å‡†

```
âœ“ è‡³å°‘ 1 æ¬¡ run è¾¾åˆ° success=true
âœ“ sources[] ä¸­æœ‰çœŸå®æ•°æ®ï¼ˆä¸æ˜¯å‡æ•°æ®ï¼‰
âœ“ èƒ½ç¨³å®šå¤ç°ï¼ˆè·‘ 3 æ¬¡ï¼Œè‡³å°‘ 1 æ¬¡æˆåŠŸï¼‰
```

**å¦‚æœæˆåŠŸç‡ <30%**ï¼š
- æ£€æŸ¥æ˜¯å¦è¢«åçˆ¬æ‹¦æˆªï¼ˆçœ‹ debug.screenshot_pathï¼‰
- è€ƒè™‘æ›´æ¢æœç´¢å¼•æ“ï¼ˆGoogle â†’ DuckDuckGoï¼‰
- è€ƒè™‘å¯åŠ¨å¤‡é€‰æ–¹æ¡ˆï¼ˆè§"é£é™©ç‚¹ 1"ï¼‰

---

### ğŸ“ **é˜¶æ®µ 2ï¼šç¨³å®šæ€§éªŒè¯ï¼ˆé¢„è®¡ 1-2 å¤©ï¼‰**

**ç›®æ ‡**ï¼šè¯æ˜è¯„ä¼°æ¡†æ¶æœ‰æ•ˆï¼Œèƒ½ç»Ÿè®¡æˆåŠŸç‡å’Œå¤±è´¥ç±»å‹ã€‚

#### æ­¥éª¤ 2.1ï¼šæ‰¹é‡è¿è¡Œå•ä»»åŠ¡

```bash
# è¿è¡Œ 10 æ¬¡ï¼ˆåŒä¸€ä»»åŠ¡ï¼Œç­–ç•¥ Aï¼‰
for i in {1..10}; do
  python3 agent/agent.py --task_id T1 --strategy_id A --timeout 90 --max_steps 8
  sleep 5  # é¿å…è§¦å‘ rate limit
done
```

#### æ­¥éª¤ 2.2ï¼šè¿è¡Œè¯„ä¼°è„šæœ¬

```bash
# åˆ›å»ºè¯„ä¼°è„šæœ¬ï¼ˆè§ä¸‹æ–‡"è‡ªåŠ¨åŒ–è„šæœ¬"éƒ¨åˆ†ï¼‰
python3 eval/analyze.py artifacts/runs.jsonl --strategy A
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== Evaluation Report (Strategy A) ===
Total runs: 10
Success rate: 60% (6/10)
Failure types:
  - agent_timeout: 30% (3/10)
  - parse_error: 10% (1/10)
Average steps (successful): 5.2
Average latency: 8234 ms
Estimated token cost: 4800
```

#### é˜¶æ®µ 2 æˆåŠŸæ ‡å‡†

```
âœ“ æˆåŠŸç‡ > 60%
âœ“ èƒ½ç»Ÿè®¡å¤±è´¥ç±»å‹åˆ†å¸ƒ
âœ“ å¹³å‡è€—æ—¶ < 15 ç§’
âœ“ Token æˆæœ¬ < 800/run
```

**å¦‚æœæˆåŠŸç‡ <60%**ï¼š
- åˆ†æ failure_type åˆ†å¸ƒ
- ä¼˜åŒ–è¶…æ—¶è®¾ç½®
- è€ƒè™‘å¼•å…¥é‡è¯•æœºåˆ¶

---

### ğŸ“ **é˜¶æ®µ 3ï¼šç­–ç•¥å¯¹æ¯”ï¼ˆé¢„è®¡ 2-3 å¤©ï¼‰**

**ç›®æ ‡**ï¼šè¯æ˜ A/B/C æœ‰æ˜¾è‘—å·®å¼‚ã€‚

#### æ­¥éª¤ 3.1ï¼šå®ç°ç­–ç•¥ Bï¼ˆallowlist_onlyï¼‰

```python
# agent/agent.py

def apply_strategy_b(search_results, allowlist):
    """åªä¿ç•™ allowlist ä¸­çš„åŸŸå"""
    filtered = []
    for result in search_results:
        domain = extract_domain(result['url'])
        if domain in allowlist:
            filtered.append(result)
    return filtered
```

#### æ­¥éª¤ 3.2ï¼šå®ç°ç­–ç•¥ Cï¼ˆallowlist + è¯­ä¹‰æ ¡éªŒï¼‰

```python
def apply_strategy_c(search_results, allowlist, brand_name):
    """allowlist + title å¿…é¡»åŒ…å«å“ç‰Œå"""
    filtered = []
    for result in search_results:
        domain = extract_domain(result['url'])
        if domain in allowlist and brand_name.lower() in result['title'].lower():
            filtered.append(result)
    return filtered
```

#### æ­¥éª¤ 3.3ï¼šæ‰¹é‡è¿è¡Œå¯¹æ¯”

```bash
# åˆ›å»ºæ‰¹é‡è¿è¡Œè„šæœ¬ï¼ˆè§ä¸‹æ–‡"è‡ªåŠ¨åŒ–è„šæœ¬"éƒ¨åˆ†ï¼‰
python3 agent/batch_runner.py --task_ids T1,T2,T3 --all_strategies --repeat 5
```

**é¢„æœŸè¾“å‡º**ï¼š
```
Running 45 total runs (3 tasks Ã— 3 strategies Ã— 5 repeats)
[1/45] T1 | Strategy A | Run 1/5 ... success
[2/45] T1 | Strategy A | Run 2/5 ... failed (agent_timeout)
...
[45/45] T3 | Strategy C | Run 5/5 ... success

Summary:
Strategy A: 60% success (27/45), avg_steps=6.2, avg_cost=650
Strategy B: 80% success (36/45), avg_steps=4.8, avg_cost=480
Strategy C: 70% success (31.5/45), avg_steps=4.1, avg_cost=420
```

#### æ­¥éª¤ 3.4ï¼šå¯¹æ¯”åˆ†æ

```bash
python3 eval/compare_strategies.py artifacts/runs.jsonl
```

**é¢„æœŸè¾“å‡º**ï¼š
```
=== Strategy Comparison ===

Metric              | A (free)  | B (allowlist) | C (allowlist+semantic)
--------------------|-----------|---------------|----------------------
Success rate        | 60%       | 80% (+33%)    | 70% (+17%)
Irrelevant clicks   | 45%       | 15% (-67%)    | 5% (-89%)
Avg steps           | 6.2       | 4.8 (-23%)    | 4.1 (-34%)
Avg latency (ms)    | 9500      | 7200 (-24%)   | 6500 (-32%)
Token cost/run      | 650       | 480 (-26%)    | 420 (-35%)
No results rate     | 5%        | 10% (+100%)   | 20% (+300%)

Recommendation: Strategy B (allowlist_only) æœ€ä¼˜
- æˆåŠŸç‡æå‡ 33%
- è¯¯ç‚¹ä¸‹é™ 67%
- æˆæœ¬ä¸‹é™ 26%
- No results å¢åŠ å¯æ¥å—ï¼ˆä»… 10%ï¼‰
```

#### é˜¶æ®µ 3 æˆåŠŸæ ‡å‡†

```
âœ“ ç­–ç•¥ B æˆåŠŸç‡ > ç­–ç•¥ A
âœ“ ç­–ç•¥ B è¯¯ç‚¹ç‡ < ç­–ç•¥ A
âœ“ ç­–ç•¥ C relevance_score > ç­–ç•¥ A/B
âœ“ èƒ½æ¸…æ™°çœ‹åˆ° tradeoffï¼ˆC çš„ no_results æ›´é«˜ï¼‰
```

---

### ğŸ“ **é˜¶æ®µ 4ï¼šäº§å“åŒ–è¾“å‡ºï¼ˆé¢„è®¡ 1-2 å¤©ï¼‰**

**ç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„é£é™©è¯„åˆ†å’Œæƒ…ç»ªåˆ†æã€‚

#### æ­¥éª¤ 4.1ï¼šå®ç°æƒ…ç»ªåˆ†æ

```python
# agent/sentiment.py

def analyze_sentiment(text):
    """ä½¿ç”¨ Claude API åšæƒ…ç»ªåˆ†æ"""
    prompt = f"""
    åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…ç»ªå€¾å‘ï¼ˆé’ˆå¯¹å“ç‰Œ Allbirdsï¼‰ï¼š
    
    æ–‡æœ¬ï¼š{text}
    
    è¾“å‡º JSONï¼š
    {{
      "label": "positive|neutral|negative",
      "score": -1.0 åˆ° 1.0,
      "confidence": 0.0 åˆ° 1.0
    }}
    """
    # è°ƒç”¨ Claude API...
```

#### æ­¥éª¤ 4.2ï¼šå®ç°é£é™©è¯„åˆ†

è§ä¸‹æ–‡"é£é™©è¯„åˆ†å…¬å¼"éƒ¨åˆ†ã€‚

#### æ­¥éª¤ 4.3ï¼šç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š

```bash
python3 eval/generate_report.py artifacts/runs.jsonl --output artifacts/final_report.md
```

**é¢„æœŸè¾“å‡º**ï¼š
```markdown
# Brand Safety Report - Allbirds

## Executive Summary
- Total runs: 108
- Overall success rate: 73%
- High risk signals: 15/108 (14%)
- Recommended action: Monitor "greenwashing" queries closely

## Risk Breakdown by Topic
| Query Type     | Avg Risk Score | High Risk Count |
|----------------|----------------|-----------------|
| scam           | 0.65 (high)    | 8               |
| greenwashing   | 0.58 (moderate)| 5               |
| complaint      | 0.45 (moderate)| 2               |
...
```

---

## 5. é£é™©è¯„åˆ†å…¬å¼

### 5.1 å…¬å¼å®šä¹‰

```
Risk Score = 0.4 Ã— negative_ratio + 0.3 Ã— keyword_weight + 0.3 Ã— recentness_factor
```

**å‚æ•°è¯´æ˜**ï¼š

1. **negative_ratio**ï¼ˆè´Ÿé¢æ¯”ä¾‹ï¼‰
   ```
   è´Ÿé¢æ ·æœ¬æ•° / æ€»æ ·æœ¬æ•°
   ä¾‹ï¼š10 æ¡è¯„è®ºä¸­æœ‰ 7 æ¡è´Ÿé¢ â†’ 0.7
   ```

2. **keyword_weight**ï¼ˆå…³é”®è¯æƒé‡ï¼‰
   ```
   é£é™©å…³é”®è¯åŠ æƒå¾—åˆ†
   
   å…³é”®è¯æƒé‡è¡¨ï¼š
   - scam, fraud, lawsuit: 1.0ï¼ˆæœ€é«˜é£é™©ï¼‰
   - greenwashing, misleading, false advertising: 0.8
   - complaint, refund, poor quality: 0.6
   - disappointed, not recommended: 0.4
   
   è®¡ç®—ï¼šå‘½ä¸­å…³é”®è¯çš„æœ€é«˜æƒé‡
   ```

3. **recentness_factor**ï¼ˆæ—¶é—´è¡°å‡ï¼‰
   ```
   è¶Šè¿‘çš„å†…å®¹æƒé‡è¶Šé«˜
   
   æ—¶é—´è¡°å‡å‡½æ•°ï¼š
   - 30 å¤©å†…ï¼š1.0
   - 30-90 å¤©ï¼š0.7
   - 90-180 å¤©ï¼š0.5
   - 180 å¤©+ï¼š0.3
   ```

### 5.2 é£é™©ç­‰çº§åˆ†ç±»

```
Risk Score     | Risk Level
---------------|------------
0.0 - 0.3      | low
0.3 - 0.6      | moderate
0.6 - 1.0      | high
```

### 5.3 å®ç°ç¤ºä¾‹

```python
# agent/risk_scoring.py

def calculate_risk_score(sources, analysis):
    # 1. è®¡ç®— negative_ratio
    negative_count = sum(1 for s in sources if analysis['sentiment']['score'] < -0.2)
    negative_ratio = negative_count / len(sources) if sources else 0
    
    # 2. è®¡ç®— keyword_weight
    risk_keywords = {
        "scam": 1.0, "fraud": 1.0, "lawsuit": 1.0,
        "greenwashing": 0.8, "misleading": 0.8,
        "complaint": 0.6, "refund": 0.6
    }
    max_weight = 0
    for keyword in analysis['risk_keywords']:
        max_weight = max(max_weight, risk_keywords.get(keyword, 0))
    keyword_weight = max_weight
    
    # 3. è®¡ç®— recentness_factor
    # ï¼ˆå‡è®¾ sources ä¸­æœ‰ publish_date å­—æ®µï¼‰
    avg_age_days = calculate_avg_age(sources)
    if avg_age_days <= 30:
        recentness_factor = 1.0
    elif avg_age_days <= 90:
        recentness_factor = 0.7
    elif avg_age_days <= 180:
        recentness_factor = 0.5
    else:
        recentness_factor = 0.3
    
    # 4. ç»¼åˆè®¡ç®—
    risk_score = (
        0.4 * negative_ratio +
        0.3 * keyword_weight +
        0.3 * recentness_factor
    )
    
    # 5. åˆ†çº§
    if risk_score < 0.3:
        risk_level = "low"
    elif risk_score < 0.6:
        risk_level = "moderate"
    else:
        risk_level = "high"
    
    return {
        "negative_ratio": negative_ratio,
        "keyword_weight": keyword_weight,
        "recentness_factor": recentness_factor,
        "risk_score": risk_score,
        "risk_level": risk_level
    }
```

---

## 6. æ•…éšœæ’æŸ¥

è§ç‹¬ç«‹æ–‡æ¡£ `docs/TROUBLESHOOTING.md`ï¼ˆå°†åœ¨ä¸‹ä¸€ä¸ªæ–‡ä»¶ä¸­åˆ›å»ºï¼‰

---

## 7. è‡ªåŠ¨åŒ–è„šæœ¬

### 7.1 ç¯å¢ƒå®‰è£…è„šæœ¬ï¼ˆscripts/setup.shï¼‰

```bash
#!/bin/bash
set -e

echo "=== Installing Python dependencies ==="
pip3 install --user playwright anthropic jsonschema

echo "=== Installing Playwright browsers ==="
python3 -m playwright install chromium

echo "=== Installing Node.js dependencies (if using docx-js) ==="
# npm install -g docx  # å¦‚æœéœ€è¦ç”Ÿæˆ Word æŠ¥å‘Š

echo "=== Creating directories ==="
mkdir -p artifacts
mkdir -p logs

echo "âœ“ Setup complete"
```

### 7.2 æ‰¹é‡è¿è¡Œè„šæœ¬ï¼ˆagent/batch_runner.pyï¼‰

```python
#!/usr/bin/env python3
import json
import subprocess
import sys
from pathlib import Path

def main():
    # è¯»å– tasks.json
    with open("datasets/tasks.json") as f:
        config = json.load(f)
    
    tasks = config["tasks"]
    strategies = config["strategies"]
    repeat = config.get("repeat_per_strategy", 3)
    
    # è§£æå‘½ä»¤è¡Œå‚æ•°
    import argparse
    parser = argparse.ArgumentParser()
    parser.add_argument("--task_ids", help="Comma-separated task IDs (e.g., T1,T2,T3)")
    parser.add_argument("--all_tasks", action="store_true")
    parser.add_argument("--all_strategies", action="store_true")
    parser.add_argument("--repeat", type=int, default=repeat)
    args = parser.parse_args()
    
    # é€‰æ‹©ä»»åŠ¡
    if args.all_tasks:
        selected_tasks = tasks
    elif args.task_ids:
        task_ids = args.task_ids.split(",")
        selected_tasks = [t for t in tasks if t["task_id"] in task_ids]
    else:
        print("Error: specify --all_tasks or --task_ids")
        sys.exit(1)
    
    # é€‰æ‹©ç­–ç•¥
    if args.all_strategies:
        selected_strategies = list(strategies.keys())
    else:
        selected_strategies = ["A"]  # é»˜è®¤åªè·‘ A
    
    total_runs = len(selected_tasks) * len(selected_strategies) * args.repeat
    print(f"Running {total_runs} total runs")
    
    run_count = 0
    for task in selected_tasks:
        for strategy_id in selected_strategies:
            for i in range(args.repeat):
                run_count += 1
                print(f"\n[{run_count}/{total_runs}] {task['task_id']} | Strategy {strategy_id} | Run {i+1}/{args.repeat}")
                
                cmd = [
                    "python3", "agent/agent.py",
                    "--task_id", task["task_id"],
                    "--strategy_id", strategy_id,
                    "--timeout", "90",
                    "--max_steps", "8"
                ]
                
                try:
                    result = subprocess.run(cmd, capture_output=True, text=True, timeout=120)
                    if result.returncode == 0:
                        print("... success")
                    else:
                        print(f"... failed: {result.stderr[:100]}")
                except subprocess.TimeoutExpired:
                    print("... timeout")

if __name__ == "__main__":
    main()
```

### 7.3 è¯„ä¼°è„šæœ¬ï¼ˆeval/analyze.pyï¼‰

```python
#!/usr/bin/env python3
import json
import sys
from collections import defaultdict
from pathlib import Path

def main():
    if len(sys.argv) < 2:
        print("Usage: python3 eval/analyze.py <runs.jsonl> [--strategy A]")
        sys.exit(1)
    
    filepath = sys.argv[1]
    
    # è¯»å–æ‰€æœ‰ runs
    runs = []
    with open(filepath) as f:
        for line in f:
            runs.append(json.loads(line))
    
    # è¿‡æ»¤ç­–ç•¥
    if "--strategy" in sys.argv:
        strategy_id = sys.argv[sys.argv.index("--strategy") + 1]
        runs = [r for r in runs if r["strategy_id"] == strategy_id]
    
    # ç»Ÿè®¡
    total = len(runs)
    success_count = sum(1 for r in runs if r["success"])
    
    failure_types = defaultdict(int)
    for r in runs:
        if not r["success"]:
            failure_types[r["failure_type"]] += 1
    
    successful_runs = [r for r in runs if r["success"]]
    avg_steps = sum(r["step_count"] for r in successful_runs) / len(successful_runs) if successful_runs else 0
    avg_latency = sum(r["latency_ms"] for r in successful_runs) / len(successful_runs) if successful_runs else 0
    avg_cost = sum(r["token_cost_estimate"] for r in successful_runs) / len(successful_runs) if successful_runs else 0
    
    # è¾“å‡ºæŠ¥å‘Š
    print(f"=== Evaluation Report ===")
    print(f"Total runs: {total}")
    print(f"Success rate: {success_count/total*100:.1f}% ({success_count}/{total})")
    print(f"\nFailure types:")
    for ftype, count in sorted(failure_types.items(), key=lambda x: -x[1]):
        print(f"  - {ftype}: {count/total*100:.1f}% ({count}/{total})")
    print(f"\nAverage metrics (successful runs only):")
    print(f"  Steps: {avg_steps:.1f}")
    print(f"  Latency: {avg_latency:.0f} ms")
    print(f"  Token cost: {avg_cost:.0f}")

if __name__ == "__main__":
    main()
```

---

## 8. é¢è¯•æ•…äº‹æ¨¡æ¿

### å¦‚ä½•è®²è¿°è¿™ä¸ªé¡¹ç›®ï¼ˆ3 åˆ†é’Ÿç‰ˆæœ¬ï¼‰

**èƒŒæ™¯**ï¼š
"æˆ‘åšäº†ä¸€ä¸ªå“ç‰Œåˆ›æ„å®‰å…¨ç›‘æ§çš„é¡¹ç›®ï¼Œé’ˆå¯¹ Allbirds è¿™ä¸ªç¯ä¿é‹å±¥å“ç‰Œã€‚èƒŒæ™¯æ˜¯å¹¿å‘Šç³»ç»Ÿéœ€è¦é¿å…å“ç‰Œå¹¿å‘Šå‡ºç°åœ¨ä¸å®‰å…¨çš„å†…å®¹æ—è¾¹ï¼Œæ¯”å¦‚è´Ÿé¢èˆ†è®ºã€è™šå‡å®£ä¼ æŒ‡æ§ç­‰ã€‚"

**æ–¹æ³•**ï¼š
"æˆ‘ç”¨ Web Agentï¼ˆOpenClawï¼‰è‡ªåŠ¨ä»å…¬å¼€ç½‘é¡µæŠ“å–å“ç‰Œç›¸å…³çš„èˆ†è®ºä¿¡å·ï¼ŒåŒ…æ‹¬æ–°é—»ã€è®ºå›ã€è¯„æµ‹ç­‰ã€‚ç„¶åç”¨ä¸€å¥—è¯„ä¼°æ¡†æ¶æ¥éªŒè¯ Agent çš„ç¨³å®šæ€§ï¼Œè®°å½•æˆåŠŸç‡ã€å¤±è´¥ç±»å‹ã€æˆæœ¬ç­‰æŒ‡æ ‡ã€‚"

**å®éªŒ**ï¼š
"æˆ‘è®¾è®¡äº†ä¸‰ç§ç­–ç•¥ï¼šA æ˜¯è‡ªç”±æœç´¢ï¼ŒB æ˜¯åªè®¿é—®ç™½åå•åŸŸåï¼ŒC æ˜¯ç™½åå•+è¯­ä¹‰æ ¡éªŒã€‚é€šè¿‡ A/B å®éªŒå‘ç°ï¼Œç­–ç•¥ B çš„æˆåŠŸç‡æå‡äº† 33%ï¼Œè¯¯ç‚¹ä¸‹é™äº† 67%ï¼Œæˆæœ¬é™ä½äº† 26%ã€‚ç­–ç•¥ C çš„ç›¸å…³æ€§æ›´é«˜ï¼Œä½† no_results å¢åŠ äº† 300%ï¼Œæ˜¯ä¸ªå…¸å‹çš„ precision-recall tradeoffã€‚"

**ç»“æœ**ï¼š
"æœ€ç»ˆæˆ‘äº¤ä»˜äº†ä¸€ä¸ªå¯å¤ç°çš„è¯„ä¼°æ¡†æ¶å’Œé£é™©è¯„åˆ†ç³»ç»Ÿã€‚é£é™©è¯„åˆ†åŸºäºè´Ÿé¢æ¯”ä¾‹ã€å…³é”®è¯æƒé‡å’Œæ—¶é—´è¡°å‡ï¼Œå…¬å¼æ˜¯å¯è§£é‡Šçš„ï¼Œé€‚åˆäº§å“åŒ–ã€‚"

**æŠ€èƒ½ç‚¹**ï¼š
- é‡åŒ–è¯„ä¼°ï¼ˆæˆåŠŸç‡ã€å¤±è´¥åˆ†ç±»ã€æˆæœ¬ï¼‰
- å®éªŒè®¾è®¡ï¼ˆA/B/C å¯¹æ¯”ï¼‰
- äº§å“åŒ–æ€ç»´ï¼ˆé£é™©è¯„åˆ†å…¬å¼ï¼‰
- å¯é æ€§å·¥ç¨‹ï¼ˆå¤„ç† Agent å¤±è´¥ï¼‰

---

## 9. ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ˆéå¸¸æ˜ç¡®ï¼‰

1. **åœ¨äº‘ç«¯è·‘é˜¶æ®µ 0**ï¼š
   ```bash
   bash scripts/setup.sh
   ```

2. **åœ¨äº‘ç«¯è·‘é˜¶æ®µ 1ï¼ˆv0ï¼‰**ï¼š
   ```bash
   python3 agent/agent.py --task_id T1 --strategy_id A --timeout 90 --max_steps 8
   ```

3. **æŠŠè¾“å‡ºè´´ç»™ AI**ï¼š
   ```bash
   tail -n 1 artifacts/runs.jsonl
   ```
   ç„¶åè¯´ï¼š"æˆ‘è·‘é€šäº† v0ï¼Œæ¥ä¸‹æ¥å¦‚ä½•æ¥å…¥ OpenClawï¼Ÿ"

4. **ç»§ç»­æ¨è¿›é˜¶æ®µ 1ï¼ˆv1ï¼‰**ï¼š
   - å®ç°æœ€å°æœç´¢/æ‰“å¼€/æå–æµç¨‹
   - ç›®æ ‡ï¼šsuccess=true

---

## é™„å½•

### A. é¡¹ç›®æ–‡ä»¶ç»“æ„

```
brand-safety-agent/
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ agent.py              # ä¸» Agent é€»è¾‘
â”‚   â”œâ”€â”€ batch_runner.py       # æ‰¹é‡è¿è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ sentiment.py          # æƒ…ç»ªåˆ†æ
â”‚   â””â”€â”€ risk_scoring.py       # é£é™©è¯„åˆ†
â”œâ”€â”€ datasets/
â”‚   â”œâ”€â”€ tasks.json            # ä»»åŠ¡å®šä¹‰
â”‚   â””â”€â”€ allowlist.txt         # åŸŸåç™½åå•
â”œâ”€â”€ eval/
â”‚   â”œâ”€â”€ schema.json           # è¾“å‡º schema
â”‚   â”œâ”€â”€ analyze.py            # å•ç­–ç•¥è¯„ä¼°
â”‚   â””â”€â”€ compare_strategies.py # ç­–ç•¥å¯¹æ¯”
â”œâ”€â”€ artifacts/
â”‚   â””â”€â”€ runs.jsonl            # è¾“å‡ºæ•°æ®ï¼ˆè¿½åŠ å†™å…¥ï¼‰
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh              # ç¯å¢ƒå®‰è£…è„šæœ¬
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ TROUBLESHOOTING.md    # æ•…éšœæ’æŸ¥æ–‡æ¡£
â””â”€â”€ README.md                 # æœ¬æ–‡ä»¶
```

### B. å…³é”®æ–‡ä»¶ç¤ºä¾‹

#### datasets/tasks.json
```json
{
  "brand": "Allbirds",
  "tasks": [
    {"task_id": "T1", "query": "Allbirds scam", "topic": "fraud"},
    {"task_id": "T2", "query": "Allbirds complaint", "topic": "quality"},
    {"task_id": "T3", "query": "Allbirds greenwashing", "topic": "sustainability"}
  ],
  "strategies": {
    "A": {"name": "free_planning", "use_allowlist": false, "semantic_check": false},
    "B": {"name": "allowlist_only", "use_allowlist": true, "semantic_check": false},
    "C": {"name": "allowlist_semantic", "use_allowlist": true, "semantic_check": true}
  },
  "run_defaults": {
    "timeout_seconds": 90,
    "max_steps": 8,
    "screenshot_on_failure": true
  },
  "repeat_per_strategy": 3
}
```

#### datasets/allowlist.txt
```
# æ–°é—»åª’ä½“
nytimes.com
theguardian.com
forbes.com
businessinsider.com

# æ¶ˆè´¹è€…è¯„æµ‹
trustpilot.com
consumeraffairs.com

# è®ºå›ï¼ˆæ§åˆ¶é¢‘ç‡ï¼‰
reddit.com

# å¯æŒç»­æ€§
greenbiz.com
sustainablebrands.com
```

---

**æœ€åæé†’**ï¼š
- æŒ‰é˜¶æ®µæ¨è¿›ï¼Œä¸è¦è·³æ­¥
- æ¯ä¸ªé˜¶æ®µçš„å¤±è´¥éƒ½æ˜¯æœ‰ä»·å€¼çš„æ•°æ®
- é‡åˆ°é—®é¢˜å°±é—® AIï¼Œä¸è¦è‡ªå·±çŒœ
- æˆåŠŸç‡ 60% å·²ç»è¶³å¤Ÿå†™è¿›ç®€å†

Good luck! ğŸš€